<%# Hi guys!
So in this page we are showing the overview of all the subtasks (it is essentially the subtask index page
with probably a bit of info on the task)
If they are a client, they cannot add edit the task or subtasks or add new ones.
We must do <% if Project.contractor? %>

<div class="logo d-flex justify-content-center"><h2>contio</h2></div>
<div class="main-container-all " id="task-page" data-controller="task-progress">
          <div class="row" style="">
            <h1 class="subtask-h1"><strong><%= @task.name %></strong> </h1>
          </div>
          <div class="border-bottom"></div>
<div class="sticky-show-page">


                <div class="row" style="padding-top: 5px; padding-bottom: 8px">

                            <div class="col">

                                <div class="progresswheel">
                                  <div style="position:relative">
                                        <svg>
                                        <circle class="bg" cx="57" cy="57" r="52" />
                                        <circle data-task-progress-target="svg" style="stroke-dashoffset: <%= 380 - (360.0 * @percentage / 100.0) %>; transition: stroke-dashoffset 1.5s;"class="meter-1" cx="57" cy="57" r="52" />
                                      </svg>
                                      <h2 data-task-progress-target="percentage" style="position:absolute; top:37%; left:19%"> <%= @percentage.round %> % </h2>
                                  </div>
                                </div>
                            </div>

                            <div class="col">
                              <div class="row" style="padding-bottom: 10px">
                                <div class="subtask-intro">
                                    <div>
                                      <h6> Start Date: </h6>
                                      <h6> <strong><%= @task.start_date.strftime("%d %b") %> </strong></h6>
                                    </div>
                                </div>
                              </div>

                              <div class="row">
                                <div class="subtask-intro">
                                    <div>
                                      <h6> End Date: </h6>
                                      <h6> <strong><%= @task.end_date.strftime("%d %b") %> </strong></h6>
                                    </div>
                                </div>
                              </div>
                            </div>
                </div>




  <div class="border-bottom"></div>

    <div id="tasks-title" style="padding-top: 3px">
        <div><strong><%= @task.sub_tasks.count %> subtasks: </strong>
    </div>

        <button type="button" class="btn btn-task" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <i class="fa-solid fa-plus"></i> Add subtask
        </button>
      </div>
</div>
    <div class="border-bottom"></div>
    <% @task.sub_tasks.each do |sub_task|%>


      <div class="contio-card" style="margin-bottom: 5px">

        <div class="row" >
              <div class="col-2" data-controller="sub-tasks" data-task-id="<%= @task.id %>" data-project-id="<%= @task.project.id %>">
                <%= form_with(model: sub_task) do |form| %>
                  <%= form.check_box :completed,
                        data: {
                         id: sub_task.id,
                         action: "change->sub-tasks#toggle sub-tasks:toggle->task-progress#recalculate",
                         task_progress_target: "complete"
                       }, id:"subtaskcheckbox" %>

                <% end %>
              </div>

              <div class="col" style="padding-left: 20px; padding-top: 8px" >
                  <div class="row">
                    <p style="margin-bottom: 1px;"><strong> <%=  sub_task.name %> </strong></p>
                  </div>
                  <div class="border-bottom" style="margin-right: 50px"></div>
                  <div class="row">
                    <p style="padding-top: 1px"><%=  sub_task.description %></p>
                  </div>

              </div>
        </div>
      </div>

    <% end %>


    </div>
    </div>


        <!-- Button trigger modal -->

  <button type="button" class="btn btn-plus" data-bs-toggle="modal" data-bs-target="#exampleModal">
    <i class="fa-solid fa-plus"></i>
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add New Subtask</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <%= render "sub_tasks/sub_task_form", task: @task %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
